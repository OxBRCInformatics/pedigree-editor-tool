/*! pedigree-editor-tool - v1.3.0 - 2017-05-19
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var GeneLegend=Class.create(Legend,{initialize:function($super){$super("Candidate Genes",!0)},_getPrefix:function(id){return"gene"},_generateElement:function($super,geneID,name){if(!this._objectColors.hasOwnProperty(geneID)){var color=this._generateColor(geneID);this._objectColors[geneID]=color,document.fire("gene:color",{id:geneID,color:color})}return $super(geneID,name)},_onDropObject:function(node,geneID){if(!node.isPersonGroup()){var currentGenes=node.getGenes().slice(0);if(-1==currentGenes.indexOf(geneID)){currentGenes.push(geneID),editor.getView().unmarkAll();var properties={setGenes:currentGenes},event={nodeID:node.getID(),properties:properties};document.fire("pedigree:node:setproperty",event)}else this._onFailedDrag(node,"This person already has the selected candidate gene","Can't drag this gene to this person")}},_generateColor:function(geneID){if(this._objectColors.hasOwnProperty(geneID))return this._objectColors[geneID];var usedColors=Object.values(this._objectColors),prefColors=["#81a270","#c4e8c4","#56a270","#b3b16f","#4a775a","#65caa3"];if(null!==this.getPreferedColor(geneID)&&prefColors.unshift(this.getPreferedColor(geneID)),usedColors.each(function(color){prefColors=prefColors.without(color)}),prefColors.length>0)return prefColors[0];for(var randomColor=Raphael.getColor();"#ffffff"==randomColor||-1!=usedColors.indexOf(randomColor);)randomColor="#"+((1<<24)*Math.random()|0).toString(16);return randomColor}});