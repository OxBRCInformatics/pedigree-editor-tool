/*! pedigree-editor-tool - v1.3.1 - 2017-05-22
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var GraphicHelpers={};GraphicHelpers.sector=function(canvas,xPosition,yPosition,radius,gender,startAngle,endAngle,color){function sideAtAngle(angle){return((angle+45)/90).floor()%4}function tanOfDegrees(degrees){var radians=degrees*Math.PI/180;return Math.tan(radians)}function getCoord(alpha){var side=sideAtAngle(alpha),result={},xFactor=side%2,yFactor=1-side%2,sideFactor=side%3?-1:1;result.angle=(alpha-90*side-(0==side&&alpha>45?360:0))*(side<2?-1:1);var d=r*tanOfDegrees(result.angle);return result.x=cx+xFactor*d+yFactor*sideFactor*r,result.y=cy+yFactor*d+xFactor*sideFactor*r,result}function getNextCorner(side){var factorA=side%3?-1:1,factorB=side<2?-1:1,result={};return result.x=cx+factorA*r,result.y=cy+factorB*r,result}var gen=gender,cx=xPosition,cy=yPosition,r=radius,paper=canvas,rad=Math.PI/180,shapeAttributes={fill:color,"stroke-width":0},circleCoordinate=function(alpha){return[cx+r*Math.cos(-alpha*rad),cy+r*Math.sin(-alpha*rad)]};if("F"===gen){if(endAngle-startAngle==360)return paper.circle(cx,cy,r).attr(shapeAttributes);var x1=circleCoordinate(startAngle)[0],x2=circleCoordinate(endAngle)[0],y1=circleCoordinate(startAngle)[1],y2=circleCoordinate(endAngle)[1];return paper.path(["M",cx,cy,"L",x1,y1,"A",r,r,0,+(endAngle-startAngle>180),0,x2,y2,"z"]).attr(shapeAttributes)}if("M"===gen){var startSide=sideAtAngle(startAngle),endSide=sideAtAngle(endAngle);0==endSide&&endAngle>startAngle&&(endSide=startAngle>=315?0:4);for(var numSides=endSide-startSide,startCoord=getCoord(startAngle),endCoord=getCoord(endAngle),sectorPathData=["M",endCoord.x,endCoord.y,"L",cx,cy,"L",startCoord.x,startCoord.y],currentSide=startSide;numSides>0;)sectorPathData.push("L",getNextCorner(currentSide).x+" "+getNextCorner(currentSide).y),currentSide=++currentSide%4,numSides--;return sectorPathData.push("L",endCoord.x,endCoord.y,"z"),paper.path(sectorPathData).attr(shapeAttributes)}var shape=GraphicHelpers.sector(paper,cx,cy,r*(Math.sqrt(3)/2),"M",startAngle,endAngle,color);return shape.transform(["...r-45,",cx,cy]).attr(shapeAttributes),shape},GraphicHelpers.generateOrb=function(canvas,x,y,r,gender){if(!gender||"F"==gender)return canvas.set(canvas.ellipse(x,y,r,r),canvas.ellipse(x,y,r-r/5,r-r/20).attr({stroke:"none",fill:"r(.5,.1)#ccc-#ccc",opacity:0}));if("M"==gender){rr=r-1;return canvas.set(canvas.rect(x-rr,y-rr,2*rr,2*rr,0),canvas.rect(x-rr,y-rr,2*rr,2*rr,1).attr({stroke:"none",fill:"330-#ccc-#ccc",opacity:0}))}if("U"==gender){var rr=.9*(r-1);return canvas.set(canvas.rect(x-rr,y-rr,2*rr,2*rr,0).attr({transform:"r45"}),canvas.rect(x-rr,y-rr,2*rr,2*rr,1).attr({stroke:"none",fill:"330-#ccc-#ccc",opacity:0}).attr({transform:"r45"}))}},GraphicHelpers.drawCornerCurve=function(xFrom,yFrom,xTo,yTo,bendDown,attr,doubleCurve,shiftx1,shifty1,shiftx2,shifty2){var curve,xDistance=xTo-xFrom,yDistance=yFrom-yTo,dist1x=xDistance/2,dist2x=xDistance/10,dist1y=yDistance/2,dist2y=yDistance/10;if(bendDown){raphaelPath="M "+xFrom+" "+yFrom+" C "+(xFrom+dist1x)+" "+(yFrom+dist2y)+" "+(xTo+dist2x)+" "+(yTo+dist1y)+" "+xTo+" "+yTo;curve=editor.getPaper().path(raphaelPath).attr(attr).toBack()}else{var raphaelPath="M "+xFrom+" "+yFrom+" C "+(xFrom-dist2x)+" "+(yFrom-dist1y)+" "+(xTo-dist1x)+" "+(yTo-dist2y)+" "+xTo+" "+yTo;curve=editor.getPaper().path(raphaelPath).attr(attr).toBack()}if(doubleCurve){var curve2=curve.clone().toBack();curve.transform("t "+shiftx1+","+shifty1+"..."),curve2.transform("t "+shiftx2+","+shifty2+"...")}},GraphicHelpers.drawLevelChangeCurve=function(xFrom,yFrom,xTo,yTo,attr,doubleCurve,shiftx1,shifty1,shiftx2,shifty2){var dist1x=(xTo-xFrom)/2,raphaelPath=" M "+xFrom+" "+yFrom;if(raphaelPath+=" C "+(xFrom+dist1x)+" "+yFrom+" "+(xTo-dist1x)+" "+yTo+" "+xTo+" "+yTo,curve=editor.getPaper().path(raphaelPath).attr(attr).toBack(),doubleCurve){var curve2=curve.clone().toBack();curve.transform("t "+shiftx1+","+shifty1+"..."),curve2.transform("t "+shiftx2+","+shifty2+"...")}},GraphicHelpers.findXInterceptGivenLineAndY=function(crossY,x1,y1,x2,y2){if(x1==x2)return x1;var a=(y1-y2)/(x1-x2);return(crossY-(y1-a*x1))/a},GraphicHelpers.getElementHalfHeight=function(t){return Math.floor(t.getBBox().height/2)},GraphicHelpers.getCaretPosition=function(elem){if(void 0!==elem.selectionEnd)return elem.selectionEnd;if(elem.createTextRange&&document.selection){var r=document.selection.createRange();return r.moveStart("character",-elem.value.length),r.text.length}return null},GraphicHelpers.setCaretPosition=function(ctrl,pos){if(!(null==pos||pos<=0))if(ctrl.setSelectionRange)ctrl.focus(),ctrl.setSelectionRange(pos,pos);else if(ctrl.createTextRange){var range=ctrl.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}},Raphael.st.flatten=function(){var flattenedSet=new Raphael.st.constructor;return this.forEach(function(element){flattenedSet=flattenedSet.concat(element.flatten())}),flattenedSet},Raphael.el.flatten=function(){return this.paper.set(this)},Raphael.st.concat=function(set){var newSet=this.copy();return"function"==typeof set.forEach?set.forEach(function(element){newSet.push(element)}):newSet.push(set),newSet},Raphael.st.contains=function(target){var found=!1;return this.forEach(function(element){element==target&&(found=!0)}),found},Raphael.st.copy=function(){var newSet=new Raphael.st.constructor;return this.forEach(function(element){newSet.push(element)}),newSet},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}();