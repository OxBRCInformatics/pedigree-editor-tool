/*! pedigree-editor-tool - v1.3.1 - 2017-05-22
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var XWiki=function(XWiki){XWiki.SearchSuggest=Class.create({initialize:function(searchInput,sources){this.sources=sources,this.searchInput=$(searchInput),this.searchInput&&(document.observe("xwiki:suggest:clearSuggestions",this.onClearSuggestions.bindAsEventListener(this)),document.observe("xwiki:suggest:containerCreated",this.onSuggestContainerCreated.bindAsEventListener(this)),document.observe("xwiki:suggest:containerPrepared",this.onSuggestContainerPrepared.bindAsEventListener(this)),document.observe("xwiki:suggest:updated",this.onSuggestUpdated.bindAsEventListener(this)),document.observe("xwiki:suggest:selected",this.onSuggestionSelected.bindAsEventListener(this)),this.createSuggest())},onClearSuggestions:function(event){event.memo.suggest==this.suggest&&this.searchInput.setStyle({borderBottomStyle:this.searchInputBorderBottomSavedStyle})},onSuggestContainerCreated:function(event){event.memo.suggest==this.suggest&&(this.searchInputBorderBottomSavedStyle=this.searchInput.getStyle("borderBottomStyle"),this.searchInput.setStyle({borderBottomStyle:"none"}))},onSuggestContainerPrepared:function(event){this.noResultsMessage.addClassName("hidden")},onSuggestUpdated:function(event){1==event.memo.container.select(".suggestItem").length&&this.noResultsMessage.removeClassName("hidden").setStyle({float:"left"})},onSuggestionSelected:function(event){event.memo.suggest==this.suggest&&(event.stop(),event.memo.originalEvent&&Event.stop(event.memo.originalEvent),event.memo.id?window.location=event.memo.id:this.searchInput.up("form").submit())},createSuggest:function(){var valueNode=new Element("div").insert(new Element("span",{class:"suggestId"})).insert(new Element("span",{class:"suggestValue"})).insert(new Element("span",{class:"suggestInfo"}));this.noResultsMessage=new Element("div",{class:"hidden"}).update("No results!".escapeHTML());var gotoSearchPageMessage=new Element("div").update("Go to search pageâ€¦".escapeHTML()),content=new Element("div").insert(this.noResultsMessage).insert(gotoSearchPageMessage).insert(new Element("div",{class:"clearfloats"})),allResults=new XWiki.widgets.XList([new XWiki.widgets.XListItem(content,{containerClasses:"suggestItem",classes:"showAllResults",eventCallbackScope:this,noHighlight:!0,value:valueNode})],{classes:"suggestList",eventListeners:{click:function(event){this.searchInput.up("form").submit()},mouseover:function(event){this.suggest.clearHighlight(),this.suggest.iHighlighted=event.element(),event.element().addClassName("xhighlight")}}}).getElement();this.suggest=new XWiki.widgets.Suggest(this.searchInput,{parentContainer:$("searchSuggest"),className:"searchSuggest horizontalLayout",fadeOnClear:!1,align:"auto",minchars:1,sources:this.sources,insertBeforeSuggestions:new Element("div",{class:"results"}).update(allResults),displayValue:!0,displayValueText:"in ",timeout:0,width:500,unifiedLoader:!0,loaderNode:allResults.down("li"),shownoresults:!1,propagateEventKeyCodes:[Event.KEY_RETURN]})}});var init=function(){var sources=[{name:"Matching patients",varname:"input",script:"/get/PhenoTips/SuggestPatientsService?outputSyntax=plain&permission=view&query=__INPUT__&nb=5",icon:"resources/icons/silk/user.png",highlight:!1}];return new XWiki.SearchSuggest($("headerglobalsearchinput"),sources),!0};return XWiki.isInitialized&&init()||document.observe("xwiki:dom:loading",init),XWiki}(XWiki);