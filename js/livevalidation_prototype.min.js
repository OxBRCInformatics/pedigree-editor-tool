/*! pedigree-editor-tool - v1.3.1 - 2017-05-22
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var LiveValidation=Class.create();Object.extend(LiveValidation,{VERSION:"1.3 prototype",TEXTAREA:1,TEXT:2,PASSWORD:3,CHECKBOX:4,SELECT:5,FILE:6,massValidate:function(c){for(var d=!0,b=0,a=c.length;b<a;++b){var e=c[b].validate();d&&(d=e)}return d}}),LiveValidation.prototype={validClass:"LV_valid",invalidClass:"LV_invalid",messageClass:"LV_validation_message",validFieldClass:"LV_valid_field",invalidFieldClass:"LV_invalid_field",initialize:function(b,a){if(!b)throw new Error("LiveValidation::initialize - No element reference or element id has been provided!");if(this.element=$(b),!this.element)throw new Error("LiveValidation::initialize - No element with reference or id of '"+b+"' exists!");this.elementType=this.getElementType(),this.validations=[],this.form=this.element.form,this.options=Object.extend({validMessage:"Thankyou!",onValid:function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass()},onInvalid:function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass()},insertAfterWhatNode:this.element,onlyOnBlur:!1,wait:0,onlyOnSubmit:!1},a||{});var c=this.options.insertAfterWhatNode||this.element;if(this.options.insertAfterWhatNode=$(c),Object.extend(this,this.options),this.form&&(this.formObj=LiveValidationForm.getInstance(this.form),this.formObj.addField(this)),this.boundFocus=this.doOnFocus.bindAsEventListener(this),Event.observe(this.element,"focus",this.boundFocus),!this.onlyOnSubmit)switch(this.elementType){case LiveValidation.CHECKBOX:this.boundClick=this.validate.bindAsEventListener(this),Event.observe(this.element,"click",this.boundClick);case LiveValidation.SELECT:case LiveValidation.FILE:this.boundChange=this.validate.bindAsEventListener(this),Event.observe(this.element,"change",this.boundChange);break;default:this.onlyOnBlur||(this.boundKeyup=this.deferValidation.bindAsEventListener(this),Event.observe(this.element,"keyup",this.boundKeyup)),this.boundBlur=this.validate.bindAsEventListener(this),Event.observe(this.element,"blur",this.boundBlur)}},destroy:function(){if(this.formObj&&(this.formObj.removeField(this),this.formObj.destroy()),Event.stopObserving(this.element,"focus",this.boundFocus),!this.onlyOnSubmit)switch(this.elementType){case LiveValidation.CHECKBOX:Event.stopObserving(this.element,"click",this.boundClick);case LiveValidation.SELECT:case LiveValidation.FILE:Event.stopObserving(this.element,"change",this.boundChange);break;default:this.onlyOnBlur||Event.stopObserving(this.element,"keyup",this.boundKeyup),Event.stopObserving(this.element,"blur",this.boundBlur)}this.validations=[],this.removeMessageAndFieldClass()},add:function(a,b){return this.validations.push({type:a,params:b||{}}),this},remove:function(a,b){return this.validations=this.validations.reject(function(c){return c.type==a&&c.params==b}),this},deferValidation:function(a){this.wait>=300&&this.removeMessageAndFieldClass(),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.validate.bind(this),this.wait)},doOnBlur:function(){this.focused=!1,this.validate()},doOnFocus:function(){this.focused=!0,this.removeMessageAndFieldClass()},getElementType:function(){switch(!0){case"TEXTAREA"==this.element.nodeName.toUpperCase():return LiveValidation.TEXTAREA;case"INPUT"==this.element.nodeName.toUpperCase()&&"TEXT"==this.element.type.toUpperCase():return LiveValidation.TEXT;case"INPUT"==this.element.nodeName.toUpperCase()&&"PASSWORD"==this.element.type.toUpperCase():return LiveValidation.PASSWORD;case"INPUT"==this.element.nodeName.toUpperCase()&&"CHECKBOX"==this.element.type.toUpperCase():return LiveValidation.CHECKBOX;case"INPUT"==this.element.nodeName.toUpperCase()&&"FILE"==this.element.type.toUpperCase():return LiveValidation.FILE;case"SELECT"==this.element.nodeName.toUpperCase():return LiveValidation.SELECT;case"INPUT"==this.element.nodeName.toUpperCase():throw new Error("LiveValidation::getElementType - Cannot use LiveValidation on an "+this.element.type+" input!");default:throw new Error("LiveValidation::getElementType - Element must be an input, select, or textarea!")}},doValidations:function(){this.validationFailed=!1;for(var c=0,a=this.validations.length;c<a;++c){var b=this.validations[c];switch(b.type){case Validate.Presence:case Validate.Confirmation:case Validate.Acceptance:this.displayMessageWhenEmpty=!0,this.validationFailed=!this.validateElement(b.type,b.params);break;default:this.validationFailed=!this.validateElement(b.type,b.params)}if(this.validationFailed)return!1}return this.message=this.validMessage,!0},validateElement:function(a,c){var d=this.elementType==LiveValidation.SELECT?this.element.options[this.element.selectedIndex].value:this.element.value;if(a==Validate.Acceptance){if(this.elementType!=LiveValidation.CHECKBOX)throw new Error("LiveValidation::validateElement - Element to validate acceptance must be a checkbox!");d=this.element.checked}var e=!0;try{a(d,c)}catch(b){if(!(b instanceof Validate.Error))throw b;(""!==d||""===d&&this.displayMessageWhenEmpty)&&(this.validationFailed=!0,this.message=b.message,e=!1)}finally{return e}},validate:function(){return!!this.element.disabled||(this.doValidations()?(this.onValid(),!0):(this.onInvalid(),!1))},enable:function(){return this.element.disabled=!1,this},disable:function(){return this.element.disabled=!0,this.removeMessageAndFieldClass(),this},createMessageSpan:function(){var a=document.createElement("span"),b=document.createTextNode(this.message);return a.appendChild(b),a},insertMessage:function(b){this.removeMessage();var a=this.validationFailed?this.invalidClass:this.validClass;(this.displayMessageWhenEmpty&&(this.elementType==LiveValidation.CHECKBOX||""==this.element.value)||""!=this.element.value)&&($(b).addClassName(this.messageClass+" "+a),(nxtSibling=this.insertAfterWhatNode.nextSibling)?this.insertAfterWhatNode.parentNode.insertBefore(b,nxtSibling):this.insertAfterWhatNode.parentNode.appendChild(b))},addFieldClass:function(){this.removeFieldClass(),this.validationFailed?this.element.hasClassName(this.invalidFieldClass)||this.element.addClassName(this.invalidFieldClass):(this.displayMessageWhenEmpty||""!=this.element.value)&&(this.element.hasClassName(this.validFieldClass)||this.element.addClassName(this.validFieldClass))},removeMessage:function(){(nxtEl=this.insertAfterWhatNode.next("."+this.messageClass))&&nxtEl.remove()},removeFieldClass:function(){this.element.removeClassName(this.invalidFieldClass),this.element.removeClassName(this.validFieldClass)},removeMessageAndFieldClass:function(){this.removeMessage(),this.removeFieldClass()}};var LiveValidationForm=Class.create();Object.extend(LiveValidationForm,{instances:{},getInstance:function(a){var b=Math.random()*Math.random();return a.id||(a.id="formId_"+b.toString().replace(/\./,"")+(new Date).valueOf()),LiveValidationForm.instances[a.id]||(LiveValidationForm.instances[a.id]=new LiveValidationForm(a)),LiveValidationForm.instances[a.id]}}),LiveValidationForm.prototype={initialize:function(a){this.element=$(a),this.fields=[],this.oldOnSubmit=this.element.onsubmit||function(){},this.element.onsubmit=function(c){!!LiveValidation.massValidate(this.fields)&&!1!==this.oldOnSubmit.call(this.element,c)||Event.stop(c)}.bindAsEventListener(this)},addField:function(a){this.fields.push(a)},removeField:function(a){this.fields=this.fields.without(a)},destroy:function(a){return!(0!=this.fields.length&&!a)&&(this.element.onsubmit=this.oldOnSubmit,LiveValidationForm.instances[this.element.id]=null,!0)}};var Validate={Presence:function(a,b){var c=Object.extend({failureMessage:"Can't be empty!"},b||{});return""!==a&&null!==a&&void 0!==a||Validate.fail(c.failureMessage),!0},Numericality:function(b,c){var a=b,b=Number(b),d={notANumberMessage:(c=c||{}).notANumberMessage||"Must be a number!",notAnIntegerMessage:c.notAnIntegerMessage||"Must be an integer!",wrongNumberMessage:c.wrongNumberMessage||"Must be "+c.is+"!",tooLowMessage:c.tooLowMessage||"Must not be less than "+c.minimum+"!",tooHighMessage:c.tooHighMessage||"Must not be more than "+c.maximum+"!",is:c.is||0==c.is?c.is:null,minimum:c.minimum||0==c.minimum?c.minimum:null,maximum:c.maximum||0==c.maximum?c.maximum:null,onlyInteger:c.onlyInteger||!1};switch(isFinite(b)||Validate.fail(d.notANumberMessage),d.onlyInteger&&(/\.0+$|\.$/.test(String(a))||b!=parseInt(b))&&Validate.fail(d.notAnIntegerMessage),!0){case null!==d.is:b!=Number(d.is)&&Validate.fail(d.wrongNumberMessage);break;case null!==d.minimum&&null!==d.maximum:Validate.Numericality(b,{tooLowMessage:d.tooLowMessage,minimum:d.minimum}),Validate.Numericality(b,{tooHighMessage:d.tooHighMessage,maximum:d.maximum});break;case null!==d.minimum:b<Number(d.minimum)&&Validate.fail(d.tooLowMessage);break;case null!==d.maximum:b>Number(d.maximum)&&Validate.fail(d.tooHighMessage)}return!0},Format:function(a,b){var a=String(a),c=Object.extend({failureMessage:"Not valid!",pattern:/./,negate:!1},b||{});return c.negate||c.pattern.test(a)||Validate.fail(c.failureMessage),c.negate&&c.pattern.test(a)&&Validate.fail(c.failureMessage),!0},Email:function(a,b){var c=Object.extend({failureMessage:"Must be a valid email address!"},b||{});return Validate.Format(a,{failureMessage:c.failureMessage,pattern:/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i}),!0},Length:function(a,b){var a=String(a),c={wrongLengthMessage:(b=b||{}).wrongLengthMessage||"Must be "+b.is+" characters long!",tooShortMessage:b.tooShortMessage||"Must not be less than "+b.minimum+" characters long!",tooLongMessage:b.tooLongMessage||"Must not be more than "+b.maximum+" characters long!",is:b.is||0==b.is?b.is:null,minimum:b.minimum||0==b.minimum?b.minimum:null,maximum:b.maximum||0==b.maximum?b.maximum:null};switch(!0){case null!==c.is:a.length!=Number(c.is)&&Validate.fail(c.wrongLengthMessage);break;case null!==c.minimum&&null!==c.maximum:Validate.Length(a,{tooShortMessage:c.tooShortMessage,minimum:c.minimum}),Validate.Length(a,{tooLongMessage:c.tooLongMessage,maximum:c.maximum});break;case null!==c.minimum:a.length<Number(c.minimum)&&Validate.fail(c.tooShortMessage);break;case null!==c.maximum:a.length>Number(c.maximum)&&Validate.fail(c.tooLongMessage);break;default:throw new Error("Validate::Length - Length(s) to validate against must be provided!")}return!0},Inclusion:function(c,d){var e=Object.extend({failureMessage:"Must be included in the list!",within:[],allowNull:!1,partialMatch:!1,caseSensitive:!0,negate:!1},d||{});if(e.allowNull&&null==c)return!0;if(e.allowNull||null!=c||Validate.fail(e.failureMessage),!e.caseSensitive){var a=[];e.within.each(function(f){"string"==typeof f&&(f=f.toLowerCase()),a.push(f)}),e.within=a,"string"==typeof c&&(c=c.toLowerCase())}var b=-1!=e.within.indexOf(c);return e.partialMatch&&(b=!1,e.within.each(function(f){-1!=c.indexOf(f)&&(b=!0)})),(!e.negate&&!b||e.negate&&b)&&Validate.fail(e.failureMessage),!0},Exclusion:function(a,b){var c=Object.extend({failureMessage:"Must not be included in the list!",within:[],allowNull:!1,partialMatch:!1,caseSensitive:!0},b||{});return c.negate=!0,Validate.Inclusion(a,c),!0},Confirmation:function(a,b){if(!b.match)throw new Error("Validate::Confirmation - Error validating confirmation: Id of element to match must be provided!");var c=Object.extend({failureMessage:"Does not match!",match:null},b||{});if(c.match=$(b.match),!c.match)throw new Error("Validate::Confirmation - There is no reference with name of, or element with id of '"+c.match+"'!");return a!=c.match.value&&Validate.fail(c.failureMessage),!0},Acceptance:function(a,b){var c=Object.extend({failureMessage:"Must be accepted!"},b||{});return a||Validate.fail(c.failureMessage),!0},Custom:function(a,b){var c=Object.extend({against:function(){return!0},args:{},failureMessage:"Not valid!"},b||{});return c.against(a,c.args)||Validate.fail(c.failureMessage),!0},now:function(a,d,c){if(!a)throw new Error("Validate::now - Validation function must be provided!");var e=!0;try{a(d,c||{})}catch(b){if(!(b instanceof Validate.Error))throw b;e=!1}finally{return e}},Error:function(a){this.message=a,this.name="ValidationError"},fail:function(a){throw new Validate.Error(a)}};