/*! pedigree-editor-tool - v1.3.1 - 2017-05-22
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var LineSet=Class.create({initialize:function(){this._lineCrossings={},this._lines=[]},replaceIDs:function(changedIdsSet){var newLineCrossings={};for(var oldOwnerID in this._lineCrossings)if(this._lineCrossings.hasOwnProperty(oldOwnerID)){var crosses=this._lineCrossings[oldOwnerID],newCrosses={};for(var oldID in crosses)crosses.hasOwnProperty(oldID)&&(newCrosses[newID=changedIdsSet.hasOwnProperty(oldID)?changedIdsSet[oldID]:oldID]=!0);newLineCrossings[changedIdsSet.hasOwnProperty(oldOwnerID)?changedIdsSet[oldOwnerID]:oldOwnerID]=newCrosses}this._lineCrossings=newLineCrossings;for(var i=0;i<this._lines.length;i++){var oldID=this._lines[i].owner,newID=changedIdsSet.hasOwnProperty(oldID)?changedIdsSet[oldID]:oldID;this._lines[i].owner=newID}},addLine:function(owner,x1,y1,x2,y2){this._lineCrossings.hasOwnProperty(owner)||(this._lineCrossings[owner]={});for(var bendPoints=[],thisLine={owner:owner,x1:x1,y1:y1,x2:x2,y2:y2},i=0;i<this._lines.length;i++){var line=this._lines[i];if(line.owner!=owner){var crossingPoint=this._getLineCrossing(thisLine,line);crossingPoint&&(this._lineCrossings[line.owner][owner]=!0,bendPoints.push(crossingPoint))}}return this._lines.push(thisLine),bendPoints},removeAllLinesByOwner:function(owner){if(!this._lineCrossings.hasOwnProperty(owner))return{};for(var i=this._lines.length-1;i>=0;i--)this._lines[i].owner==owner&&this._lines.splice(i,1);var affectedOwners=this._lineCrossings[owner];delete this._lineCrossings[owner];for(var ownerID in this._lineCrossings)if(this._lineCrossings.hasOwnProperty(ownerID)){var crosses=this._lineCrossings[ownerID];crosses.hasOwnProperty(owner)&&delete crosses[owner]}return affectedOwners},removeAllLinesAffectedByOwnerMovement:function(owner){var returnNewAffected=[],processed={};processed[owner]=!0;for(var affected=[owner];affected.length>0;){var next=affected.pop(),newAffected=this.removeAllLinesByOwner(next);for(var o in newAffected)newAffected.hasOwnProperty(o)&&(processed.hasOwnProperty(o)||(affected.push(parseInt(o)),returnNewAffected.push(parseInt(o)),processed[o]=!0))}return returnNewAffected},_getLineCrossing:function(line1,line2){var a=line1.x2-line1.x1,b=line2.x1-line2.x2,c=line1.y2-line1.y1,d=line2.y1-line2.y2,e=line2.x1-line1.x1,f=line2.y1-line1.y1,denom=a*d-b*c;if(Math.abs(denom)<=.001)return null;var t=(e*d-b*f)/denom,s=(a*f-e*c)/denom;return t<=0||t>=1||s<=0||s>=1?0:{x:line1.x1+t*(line1.x2-line1.x1),y:line1.y1+t*(line1.y2-line1.y1)}}});