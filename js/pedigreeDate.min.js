/*! pedigree-editor-tool - v1.3.0 - 2017-05-19
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var PedigreeDate=Class.create({initialize:function(date){if(this.decade=null,this.year=null,this.month=null,this.day=null,null!=date&&date){var jsDate=null;if("string"==typeof date||date instanceof String){if(date.match(/^\d\d\d\ds$/))this.decade=date;else if(!isNaN(Date.parse(date))){var parsed=date.match(/\w\w\w (\w\w\w) (\d\d) \d\d:\d\d:\d\d \w\w\w (\d\d\d\d)/);if(null!==parsed){timezonelessDate=parsed[1]+" "+parsed[2]+", "+parsed[3];jsDate=new Date(timezonelessDate)}else if(null!==(parsed=date.match(/(\d\d\d\d)-(\d\d)-(\d\d)/))){var month0based=parseInt(parsed[2])-1,timezonelessDate=this._getMonthName("en",month0based)+" "+parsed[3]+", "+parsed[1];jsDate=new Date(timezonelessDate)}else jsDate=new Date(date)}}else"[object Date]"===Object.prototype.toString.call(date)&&(jsDate=date);null!==jsDate?(this.year=jsDate.getFullYear(),this.month=jsDate.getMonth()+1,this.day=jsDate.getDate()):"object"==typeof date&&(date.hasOwnProperty("decade")&&(this.decade=date.decade),date.hasOwnProperty("year")&&(this.year=this.parseIntOrNull(date.year)),date.hasOwnProperty("month")&&(this.month=this.parseIntOrNull(date.month)),date.hasOwnProperty("day")&&(this.day=this.parseIntOrNull(date.day))),null!==this.year&&null===this.decade&&(this.decade=this.year.toString().slice(0,-1)+"0s")}},parseIntOrNull:function(expectedInteger){var result=parseInt(expectedInteger);return isNaN(result)?null:result},toString:function(){return null===this.year&&null!==this.decade?this.decade:null!==this.year&&null==this.month?this.year.toString():null!==this.year&&null!==this.month&&null===this.day?this.getMonthName()+" "+this.year:null!==this.year&&null!==this.month&&null!==this.day?this.toJSDate().toDateString():""},getMonthName:function(locale){return null==this.getMonth()?"":(locale=locale&&locale in localeMonthNames?locale:"en",this._getMonthName(locale,this.getMonth()-1))},_getMonthName:function(locale,month0based){return{en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}[locale][month0based]},toGEDCOMString:function(){return null===this.year&&null!==this.decade?"ABT "+this.getYear(!0).toString():this.toString()},isSet:function(){return null!==this.decade||null!==this.year||null!==this.month||null!==this.day},isComplete:function(){return null!==this.decade},onlyDecadeAvailable:function(){return null!==this.decade&&null==this.year},getDecade:function(){return this.decade},getSimpleObject:function(){var date={};return null!==this.decade&&(date.decade=this.decade),null!==this.year&&(date.year=this.year),null!==this.month&&(date.month=this.month),null!==this.day&&(date.day=this.day),date},toJSDate:function(){var year=this.getYear(!0),month=this.getMonth(!0)-1,day=this.getDay(!0);return new Date(year,month,day)},getBestPrecisionStringYear:function(){return this.isComplete()?null==this.year?this.decade:this.year.toString():""},getMostConservativeYearEstimate:function(){return this.isComplete()?this.getYear(!0,!1).toString():""},getAverageYearEstimate:function(){return this.isComplete()?this.getYear(!0,!0).toString():""},getBestPrecisionStringDDMMYYY:function(dateFormat){if(dateFormat||(dateFormat="DMY"),!this.isComplete())return"";if(null==this.year)return this.decade;var dateStr=this.getYear().toString();return null!=this.getMonth()&&(dateStr=("0"+this.getMonth()).slice(-2)+"-"+dateStr,null!=this.getDay()&&"DMY"==dateFormat&&(dateStr=("0"+this.getDay()).slice(-2)+"-"+dateStr)),dateStr},getTime:function(){return this.toJSDate().getTime()},getYear:function(failsafe,average){if(this.isComplete()&&null==this.year&&failsafe){var year=parseInt(this.decade.slice(0,-1));return average&&(year+=5),year}return this.year},getMonth:function(failsafe){return this.isComplete()&&null==this.month&&failsafe?1:this.month},getDay:function(failsafe){return this.isComplete()&&null==this.day&&failsafe?1:this.day},canBeAfterDate:function(otherPedigreeDate){if(!this.isComplete())return!0;if(!otherPedigreeDate.isComplete())return!0;if(this.getTime()>otherPedigreeDate.getTime())return!0;var leastOtherYear=otherPedigreeDate.getYear(!0),leastOtherMonth=otherPedigreeDate.getMonth(!0),leastOtherDay=otherPedigreeDate.getDay(!0),maxThisYear=this.year?this.year:this.getYear(!0)+9,maxThisMonth=this.month?this.month:12,maxThisDay=this.day?this.day:31;return maxThisYear>leastOtherYear||!(maxThisYear<leastOtherYear)&&(maxThisMonth>leastOtherMonth||!(maxThisMonth<leastOtherMonth)&&maxThisDay>=leastOtherDay)}});