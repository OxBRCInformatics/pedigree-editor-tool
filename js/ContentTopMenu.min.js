/*! pedigree-editor-tool - v1.3.0-SNAPSHOT - 2017-05-19
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

document.observe("xwiki:dom:loaded",function(){var b=function(g){var d=g.findElement("a"),f=d&&d.getAttribute("href"),h=f&&$(f.substring(1)),e=h&&(h.up(".collapsible-group")||h.up(".chapter"));e&&e.hasClassName("collapsed")&&(e.removeClassName("collapsed"),e.down(".expand-tool")&&e.down(".expand-tool").update("â–¼"),e.up(".chapter")&&e.up(".chapter").removeClassName("collapsed"))},c=$("table-of-contents"),a=$("toc-entry");if(!c||!a||!c.down("ul"))return void(a&&a.up("li").remove());(a=a.up("li")).down("ul").replace(c.down("ul")),a.down("ul").select("a").invoke("observe","click",b)}),document.observe("xwiki:dom:loaded",function(){var a=$("prActionDelete");if(!a)return!1;a.observe("click",function(b){b.stop();var d=b.element();if(d.blur(),!d.disabled){var c=d.readAttribute("href")+"?confirm=1&form_token="+$$("meta[name=form_token]")[0].content+(Prototype.Browser.Opera?"":"&ajax=1");new XWiki.widgets.ConfirmedAjaxRequest(c,{onCreate:function(){d.disabled=!0},onSuccess:function(){window.location=new XWiki.Document("WebHome",XWiki.Document.currentSpace).getURL("view")},onFailure:function(){d.disabled=!1}},{confirmationText:"Are you sure you wish to move this document to the recycle bin?"})}})}),document.observe("xwiki:dom:loaded",function(){if("edit"==XWiki.contextaction){var a=$("edit")||$("inline");if(a){var e=a.form_token&&a.form_token.value,i=(a.serialize(),$$("meta[name=version]").length>0&&$$("meta[name=version]")[0].content),f=function(k){return XWiki.currentDocument.getURL("rollback","rev="+k+"&confirm=1&form_token="+e)},h=XWiki.currentDocument.getURL("delete","confirm=1&form_token="+e);if(i)var b=f(i);var j=XWiki.currentDocument.getRestURL(),d=function(l){var k=l.getElementsByTagName("version");return k.length>0&&k[0].firstChild.nodeValue};new Ajax.Request(j,{method:"get",onSuccess:function(k){!i&&(i=d(k.responseXML))&&(b=f(i))},onFailure:function(k){404==k.statusCode&&(i="none",b=h)}.bind(this)}),a.select("input[name=action_cancel]").invoke("observe","click",function(k){!a._isVersionVerified&&i&&b&&(Event.stop(k),new Ajax.Request(j,{method:"get",onCreate:function(){a._isVersionVerified=!0},onSuccess:function(m){var l=d(m.responseXML);window.onbeforeunload=function(){},l&&l!=i?window.location=b:k.element().click()}.bind(this),onFailure:function(l){window.onbeforeunload=function(){},k.element().click()}.bind(this),on0:function(l){l.request.options.onFailure(l)}}))})}}}),function(){var a=function(d){var c=$("mainContentArea"),e=$("patient-record-actions");if(c&&e)new StickyBox(e,c,{offsetTop:0})};XWiki.domIsLoaded&&a()||document.observe("xwiki:dom:loaded",a)}(),document.observe("xwiki:dom:loaded",function(){$$(" .export-link").invoke("observe","click",function(b){if(b.stop(),void 0!==b.findElement(".editbody")){var d=window.open("","_blank"),c=function(){d.location=b.findElement().href,document.stopObserving("xwiki:document:saved",c)};document.observe("xwiki:document:saved",c),document.fire("xwiki:actions:save",{continue:!0,form:b.findElement("form")})}else window.open(b.findElement().href,"_blank")})});