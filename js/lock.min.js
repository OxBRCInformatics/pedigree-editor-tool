/*! pedigree-editor-tool - v1.3.0 - 2017-05-19
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var XWiki=function(c){var a=function(f){if(!f)return c.currentDocument;if("string"==typeof f){var e=c.Model.resolve(f,c.EntityType.DOCUMENT),d=e.name,g=e.extractReferenceValue(c.EntityType.SPACE),h=e.extractReferenceValue(c.EntityType.WIKI);return new c.Document(d,g,h)}return f};c.DocumentLock=Class.create({initialize:function(e){this._document=a(e);var g=this.unlock.bind(this);Event.observe(window,"unload",g),Event.observe(window,"pagehide",g),$("tmLogout")&&$("tmLogout").down("a")&&$("tmLogout").down("a").observe("click",g);var f=this.setLocked.bind(this,!1);$$("form.withLock").each(function(h){h.observe("submit",f)});var d=new c.DocumentReference(this._document.wiki,this._document.space,this._document.page);c.DocumentLock._instances[c.Model.serialize(d)]=this},lock:function(){this._locked||(this._locked=!0,new Ajax.Request(this._getURL("lock"),{method:"get"}))},unlock:function(){this._locked&&(this._locked=!1,new Ajax.Request(this._getURL("cancel"),{method:"get",asynchronous:!1}))},setLocked:function(d){this._locked=!!d},isLocked:function(){return this._locked},_getURL:function(d){return this._document.getURL(d,"ajax=1&action="+c.contextaction+"&"+(c.docvariant||""))}}),c.DocumentLock._instances={},c.DocumentLock.get=function(e){e=a(e);var d=new c.DocumentReference(e.wiki,e.space,e.page);return c.DocumentLock._instances[c.Model.serialize(d)]};var b=function(){return c.EditLock=new c.DocumentLock,c.EditLock.lock(),!0};return c.domIsLoaded&&b()||document.observe("xwiki:dom:loaded",b),c}(XWiki||{});