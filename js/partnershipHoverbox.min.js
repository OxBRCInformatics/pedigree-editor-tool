/*! pedigree-editor-tool - v1.3.1 - 2017-05-22
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var PartnershipHoverbox=Class.create(AbstractHoverbox,{initialize:function($super,partnership,junctionX,junctionY,nodeShapes){var radius=PedigreeEditorParameters.attributes.radius;$super(partnership,.65*-radius,.8*-radius,1.3*radius,2.3*radius,junctionX,junctionY,nodeShapes),this._isMenuToggled=!1},generateHandles:function($super){if(null===this._currentHandles&&($super(),"infertile"!=this.getNode().getChildlessStatus())){var x=this.getNodeX(),y=this.getNodeY(),strokeWidth=editor.getWorkspace().getSizeNormalizedToDefaultZoom(PedigreeEditorParameters.attributes.handleStrokeWidth);editor.getPaper().setStart();var path=[["M",x,y],["L",x,y+PedigreeEditorParameters.attributes.partnershipHandleBreakY]];editor.getPaper().path(path).attr({"stroke-width":strokeWidth,stroke:"gray"}).insertBefore(this.getNode().getGraphics().getJunctionShape()),this.generateHandle("child",x,y+PedigreeEditorParameters.attributes.partnershipHandleBreakY,x,y+PedigreeEditorParameters.attributes.partnershipHandleLength),this._currentHandles.push(editor.getPaper().setFinish())}},generateButtons:function($super){null===this._currentButtons&&($super(),this.generateDeleteBtn(),this.generateMenuBtn())},generateMenuBtn:function(){var me=this,action=function(){me.toggleMenu(!me.isMenuToggled())},junctionShapedButton=this.getNode().getGraphics().getJunctionShape().clone();junctionShapedButton.attr(PedigreeEditorParameters.attributes.nodeShapeMenuOffPartner),junctionShapedButton.click(action),junctionShapedButton.hover(function(){junctionShapedButton.attr(PedigreeEditorParameters.attributes.nodeShapeMenuOnPartner)},function(){junctionShapedButton.attr(PedigreeEditorParameters.attributes.nodeShapeMenuOffPartner)}),junctionShapedButton.attr("cursor","pointer"),this._currentButtons.push(junctionShapedButton),this.disable(),this.getFrontElements().push(junctionShapedButton),this.enable()},isMenuToggled:function(){return this._isMenuToggled},toggleMenu:function(isMenuToggled){if(!this._justClosedMenu&&(this._isMenuToggled=isMenuToggled,isMenuToggled)){var optBBox=this.getBoxOnHover().getBBox(),x=optBBox.x2,y=optBBox.y,position=editor.getWorkspace().canvasToDiv(x+5,y);editor.getPartnershipMenu().show(this.getNode(),position.x,position.y)}},animateHideHoverZone:function($super){this._hidden=!0,this.isMenuToggled()||$super()},animateDrawHoverZone:function($super){this._hidden=!1,this.isMenuToggled()||$super()},handleAction:function(handleType,isDrag,curHoveredId){if(isDrag&&null!=curHoveredId){if("child"==handleType){var event={personID:curHoveredId,parentID:this.getNode().getID()};document.fire("pedigree:person:drag:newparent",event)}}else if(!isDrag&&"child"==handleType){var position=editor.getWorkspace().canvasToDiv(this.getNodeX(),this.getNodeY()+PedigreeEditorParameters.attributes.partnershipHandleLength+15);!editor.getGraph().hasNonPlaceholderNonAdoptedChildren(this.getNode().getID())?editor.getNodetypeSelectionBubble().show(this.getNode(),position.x,position.y):editor.getSiblingSelectionBubble().show(this.getNode(),position.x,position.y)}this.animateHideHoverZone()}});