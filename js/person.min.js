/*! pedigree-editor-tool - v1.3.1 - 2017-05-22
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

var Person=Class.create(AbstractPerson,{initialize:function($super,x,y,id,properties){this._isProband=0==id,!this._type&&(this._type="Person"),this._setDefault(),$super(x,y,properties.hasOwnProperty("gender")?properties.gender:"U",id),this.assignProperties(properties)},_setDefault:function(){this._phenotipsId="",Person.setMethods.sex="setGender",Person.setMethods.gender="setGender",this._firstName="",Person.setMethods.firstName="setFirstName",this._lastName="",Person.setMethods.lastName="setLastName",this._NHSNumber="",Person.setMethods.NHSNumber="setNHSNumber",this._CHINumber="",Person.setMethods.CHINumber="setCHINumber",this._gelSuperFamilyId="",Person.setMethods.gelSuperFamilyId="setGelSuperFamilyId",this._familyId="",Person.setMethods.familyId="setFamilyId",this._consanguineousPopulation="",Person.setMethods.consanguineousPopulation="setConsanguineousPopulation",this._karyotypicSex="Unknown",Person.setMethods.karyotypicSex="setKaryotypicSex",this._ancestries="",Person.setMethods.ancestries="setAncestries",this._participantId="",Person.setMethods.participantId="setParticipantId",this._registered="",Person.setMethods.registered="setRegistered",this._lastNameAtBirth="",Person.setMethods.lastNameAtBirth="setLastNameAtBirth",this._birthDate=null,Person.setMethods.birthDate="setBirthDate",this._deathDate=null,Person.setMethods.deathDate="setDeathDate",this._ageOfDeath="",Person.setMethods.ageOfDeath="setAgeOfDeath",this._ageOfDeathFormat="y",Person.setMethods.ageOfDeathFormat="setAgeOfDeathFormat",this._conceptionDate="",this._gestationAge="",Person.setMethods.gestationAge="setGestationAge",this._adoptedStatus="",Person.setMethods.adoptedStatus="setAdoptedStatus",this._externalID="",Person.setMethods.externalID="setExternalID",this._lifeStatus="alive",Person.setMethods.lifeStatus="setLifeStatus",this._childlessStatus=null,Person.setMethods.childlessStatus="setChildlessStatus",this._childlessReason="",Person.setMethods.childlessReason="setChildlessReason",this._carrierStatus="",Person.setMethods.carrierStatus="setCarrierStatus",this._disorders=[],Person.setMethods.disorders="setDisorders",this._disordersFullDetails=[],Person.setMethods.disordersFullDetails="setDisordersFullDetails",this._disorderType="",this._ageOfOnset="",this._hpoPresent="",this._familyId="",this._cancers={},Person.setMethods.cancers="setCancers",this._hpo=[],Person.setMethods.hpoTerms="setHPO",this._hpoFullDetails=[],Person.setMethods.hpoTermsFullDetails="setHPOFullDetails",this._ethnicities=[],Person.setMethods.ethnicities="setEthnicities",this._candidateGenes=[],Person.setMethods.candidateGenes="setGenes",this._twinGroup=null,Person.setMethods.twinGroup="setTwinGroup",this._monozygotic=!1,Person.setMethods.monozygotic="setMonozygotic",this._evaluated=!1,Person.setMethods.evaluated="setEvaluated",this._pedNumber="",Person.setMethods.nodeNumber="setPedNumber",this._lostContact=!1,Person.setMethods.lostContact="setLostContact"},_generateGraphics:function(x,y){return new PersonVisuals(this,x,y)},isProband:function(){return this._isProband},getPhenotipsPatientId:function(){return this._phenotipsId},setPhenotipsPatientId:function(phenotipsId){this._phenotipsId=phenotipsId},getFirstName:function(){return this._firstName},getNHSNumber:function(){return this._NHSNumber},getRegistered:function(){return this._registered},isRegistered:function(){return!(!this._registered||1!=this._registered)},getGelSuperFamilyId:function(){return this._gelSuperFamilyId},getFamilyId:function(){return this._familyId},getConsanguineousPopulation:function(){return this._consanguineousPopulation},getKaryotypicSex:function(){return this._karyotypicSex},getAncestries:function(){return this._ancestries},getCHINumber:function(){return this._CHINumber},getParticipantId:function(){return this._participantId},setFirstName:function(firstName){firstName&&(firstName=firstName.charAt(0).toUpperCase()+firstName.slice(1)),this._firstName=firstName,this.getGraphics().updateNameLabel()},setNHSNumber:function(NHSNumber){this._NHSNumber=NHSNumber,this.getGraphics().updateExternalIDLabel()},setRegistered:function(registered){this._registered=registered},setGelSuperFamilyId:function(gelSuperFamilyId){this._gelSuperFamilyId=gelSuperFamilyId},setFamilyId:function(familyId){if(this._familyId=familyId,this.isProband()){var event={familyId:this._familyId,participantId:this._participantId};document.fire("pedigree:update:topMenu",event)}},setConsanguineousPopulation:function(consanguineousPopulation){this._consanguineousPopulation=consanguineousPopulation},setKaryotypicSex:function(karyotypicSex){this._karyotypicSex=karyotypicSex},setAncestries:function(ancestries){this._ancestries=ancestries},setCHINumber:function(CHINumber){this._CHINumber=CHINumber,this.getGraphics().updateExternalIDLabel()},setParticipantId:function(participantId){if(this._participantId=participantId,this.isProband()){var event={familyId:this._familyId,participantId:this._participantId};document.fire("pedigree:update:topMenu",event)}this.getGraphics().updateExternalIDLabel()},getLastName:function(){return this._lastName},setLastName:function(lastName){return lastName&&(lastName=lastName.charAt(0).toUpperCase()+lastName.slice(1)),this._lastName=lastName,this.getGraphics().updateNameLabel(),lastName},getExternalID:function(){return this._externalID},setPedNumber:function(pedNumberString){this._pedNumber=pedNumberString,this.getGraphics().updateNumberLabel()},getPedNumber:function(){return this._pedNumber},setExternalID:function(externalID){this._externalID=externalID},getLastNameAtBirth:function(){return this._lastNameAtBirth},setLastNameAtBirth:function(lastNameAtBirth){return lastNameAtBirth&&(lastNameAtBirth=lastNameAtBirth.charAt(0).toUpperCase()+lastNameAtBirth.slice(1)),this._lastNameAtBirth=lastNameAtBirth,this.getGraphics().updateNameLabel(),lastNameAtBirth},setComments:function($super,comment){comment!=this.getComments()&&($super(comment),this.getGraphics().updateCommentsLabel())},setMonozygotic:function(monozygotic){monozygotic!=this._monozygotic&&(this._monozygotic=monozygotic)},getEvaluated:function(){return this._evaluated},setEvaluated:function(evaluationStatus){evaluationStatus!=this._evaluated&&(this._evaluated=evaluationStatus,this.getGraphics().updateEvaluationLabel())},getLostContact:function(){return this._lostContact},setAgeOfOnset:function(ageOfOnset){this._ageOfOnset=ageOfOnset},getAgeOfOnset:function(ageOfOnset){return this._ageOfOnset},setLostContact:function(lostContact){lostContact!=this._lostContact&&(this._lostContact=lostContact)},getMonozygotic:function(){return this._monozygotic},setTwinGroup:function(groupId){this._twinGroup=groupId},getLifeStatus:function(){return this._lifeStatus},isFetus:function(){return"alive"!=this.getLifeStatus()&&"deceased"!=this.getLifeStatus()},_isValidLifeStatus:function(status){return"unborn"==status||"stillborn"==status||"aborted"==status||"miscarriage"==status||"alive"==status||"deceased"==status},setLifeStatus:function(newStatus){if(this._isValidLifeStatus(newStatus)){var oldStatus=this._lifeStatus;this._lifeStatus=newStatus,"deceased"!=newStatus&&this.setDeathDate(""),"alive"==newStatus&&this.setGestationAge(),this.getGraphics().updateSBLabel(),this.isFetus()&&(this.setBirthDate(""),this.setAdopted(""),this.setChildlessStatus(null)),"alive"==newStatus&&(this.setAgeOfDeath(""),this.setAgeOfDeathFormat("y")),this.getGraphics().updateLifeStatusShapes(oldStatus),this.getGraphics().getHoverBox().regenerateHandles(),this.getGraphics().getHoverBox().regenerateButtons()}},getConceptionDate:function(){return this._conceptionDate},setConceptionDate:function(newDate){this._conceptionDate=newDate?new Date(newDate):"",this.getGraphics().updateAgeLabel()},getGestationAge:function(){if("unborn"==this.getLifeStatus()&&this.getConceptionDate()){var lastDay=new Date;return Math.round((lastDay.getTime()-this.getConceptionDate().getTime())/6048e5)}return this.isFetus()?this._gestationAge:null},setGestationAge:function(numWeeks){try{numWeeks=parseInt(numWeeks)}catch(err){numWeeks=""}if(numWeeks){this._gestationAge=numWeeks;var daysAgo=7*numWeeks,d=new Date;d.setDate(d.getDate()-daysAgo),this.setConceptionDate(d)}else this._gestationAge="",this.setConceptionDate(null);this.getGraphics().updateAgeLabel()},getBirthDate:function(){return this._birthDate},setBirthDate:function(newDate){(newDate=new PedigreeDate(newDate)).isSet()||(newDate=null),null!=newDate&&(this.setAgeOfDeath(""),this.setAgeOfDeathFormat("y")),newDate&&this.getDeathDate()&&!this.getDeathDate().canBeAfterDate(newDate)||(this._birthDate=newDate,this.getGraphics().updateAgeLabel())},getDeathDate:function(){return this._deathDate},getAgeOfDeath:function(){return this._ageOfDeath},getAgeOfDeathFormat:function(){return this._ageOfDeathFormat},setDeathDate:function(deathDate){return(deathDate=new PedigreeDate(deathDate)).isSet()||(deathDate=null),null!=deathDate&&(this.setAgeOfDeath(""),this.setAgeOfDeathFormat("y")),deathDate&&this.getBirthDate()&&!deathDate.canBeAfterDate(this.getBirthDate())||(this._deathDate=deathDate,this._deathDate&&"alive"==this.getLifeStatus()&&this.setLifeStatus("deceased")),this.getGraphics().updateAgeLabel(),this.getDeathDate()},setAgeOfDeath:function(ageOfDeath){var wasSet=this._ageOfDeath||this._ageOfDeath.length;if(this._ageOfDeath=ageOfDeath+"",this._ageOfDeath&&this._ageOfDeath.length){this.setLifeStatus("deceased"),this.setDeathDate(null),this.setBirthDate(null);var text=ageOfDeath+" "+this._ageOfDeathFormat;this.getGraphics().updateAgeLabelForGELDirectly(text)}else wasSet&&this.getGraphics().updateAgeLabelForGELDirectly("")},setAgeOfDeathFormat:function(ageOfDeathFormat){if(this._ageOfDeathFormat=ageOfDeathFormat,this._ageOfDeathFormat&&this._ageOfDeathFormat.length>0&&this._ageOfDeath&&this._ageOfDeath.length>0){var text=this._ageOfDeath+" "+this._ageOfDeathFormat;this.getGraphics().updateAgeLabelForGELDirectly(text)}},_isValidCarrierStatus:function(status){return""==status||"carrier"==status||"uncertain"==status||"affected"==status||"presymptomatic"==status},setCarrierStatus:function(status){for(var numDisorders=0,i=0;i<this._disordersFullDetails.length;i++)this._disordersFullDetails[i].valueAll.disorderType&&"GEL"==this._disordersFullDetails[i].valueAll.disorderType&&(numDisorders+=1);return(void 0===status||null===status)&&numDisorders>0?(status="affected",this.getGraphics().updateDisorderShapes(),this._carrierStatus=status,void this.getGraphics().updateCarrierGraphic()):"affected"==status&&0==numDisorders?void editor.getOkCancelDialogue().showCustomized("At least one 'GEL Disorder' should be added to make the node status 'Affected'.","Genomics England","Ok",function(){this.dialog.show()},null,null,null,null,!0):("affected"!=status&&numDisorders>0&&(status="affected",this.getGraphics().updateDisorderShapes()),void(this._isValidCarrierStatus(status)&&status!=this._carrierStatus&&(this._carrierStatus=status,this.getGraphics().updateCarrierGraphic())))},getCarrierStatus:function(){return this._carrierStatus},getAllNodeColors:function(){for(var result=[],i=0;i<this.getDisorders().length;i++)void 0!=this._disordersFullDetails&&void 0!=this._disordersFullDetails[i].valueAll&&"GEL"==this._disordersFullDetails[i].valueAll.disorderType&&result.push(editor.getDisorderLegend().getObjectColor(this.getDisorders()[i]));for(i=0;i<this.getGenes().length;i++)result.push(editor.getGeneLegend().getObjectColor(this.getGenes()[i]));for(var cancer in this.getCancers())this.getCancers().hasOwnProperty(cancer)&&this.getCancers()[cancer].hasOwnProperty("affected")&&this.getCancers()[cancer].affected&&result.push(editor.getCancerLegend().getObjectColor(cancer));return result},getDisorders:function(){return this._disorders},getDisorderType:function(){return this._disorderType},getDisordersForExport:function(){return this._disorders.slice(0)},addDisorder:function(disorder){"object"!=typeof disorder&&(disorder=editor.getDisorderLegend().getDisorder(disorder)),editor.getDisorderLegend().addCase(disorder.getDisorderId(),disorder.getName(),disorder.getValueAll(),this.getID()),this.getDisorders().push(disorder.getDisorderId()),this._disordersFullDetails.push(disorder),this.getDisorders().length>1&&this.removeDisorder("affected")},removeDisorder:function(disorderId){this.hasDisorder(disorderId)&&(editor.getDisorderLegend().removeCase(disorderId,this.getID()),this._disorders=this.getDisorders().without(disorderId));for(var i=this._disordersFullDetails.length-1;i>=0;i--)this._disordersFullDetails[i].disorderId==disorderId&&this._disordersFullDetails.splice(i,1)},setDisorders:function(disorders){for(i=this.getDisorders().length-1;i>=0;i--)this.removeDisorder(this.getDisorders()[i]);for(var i=0;i<disorders.length;i++)this.addDisorder(disorders[i]);this.getGraphics().updateDisorderShapes(),this.setCarrierStatus()},setDisorderType:function(disorderType){this._disorderType=disorderType},setDisordersFullDetails:function(disordersFullDetails){this._disordersFullDetails=disordersFullDetails},getHPO:function(){return this._hpo},getHPOForExport:function(){return this._hpo.slice(0)},addHPO:function(hpo){if("object"!=typeof hpo&&(hpo=editor.getHPOLegend().getTerm(hpo)),this.hasHPO(hpo.getID()))alert("This person already has the specified phenotype");else{editor.getHPOLegend().addCase(hpo.getID(),hpo.getName(),hpo.getValueAll(),this.getID()),this.getHPO().push(hpo.getID());for(var alreadyExists=!1,i=0;i<this._hpoFullDetails.length;i++)this._hpoFullDetails[i].hpoId==hpo&&(alreadyExists=!0);alreadyExists||this._hpoFullDetails.push(hpo)}},removeHPO:function(hpoId){if(this.hasHPO(hpoId)){editor.getHPOLegend().removeCase(hpoId,this.getID()),this._hpo=this.getHPO().without(hpoId);for(var i=0;i<this._hpoFullDetails.length;i++)if(this._hpoFullDetails[i].hpoId==hpoId){this._hpoFullDetails.splice(i,1);break}}else alert("This person doesn't have the specified HPO term")},setHPO:function(hpos){for(i=this.getHPO().length-1;i>=0;i--)this.removeHPO(this.getHPO()[i]);for(var i=0;i<hpos.length;i++)this.addHPO(hpos[i])},setHPOFullDetails:function(hpoFullDetails){this._hpoFullDetails=hpoFullDetails},hasHPO:function(id){return-1!=this.getHPO().indexOf(id)},setEthnicities:function(ethnicities){this._ethnicities=ethnicities},getEthnicities:function(){return this._ethnicities},addGene:function(gene){-1==this.getGenes().indexOf(gene)&&(editor.getGeneLegend().addCase(gene,gene,this.getID()),this.getGenes().push(gene))},removeGene:function(gene){-1!==this.getGenes().indexOf(gene)&&(editor.getGeneLegend().removeCase(gene,this.getID()),this._candidateGenes=this.getGenes().without(gene))},setGenes:function(genes){for(i=this.getGenes().length-1;i>=0;i--)this.removeGene(this.getGenes()[i]);for(var i=0;i<genes.length;i++)this.addGene(genes[i]);this.getGraphics().updateDisorderShapes()},getGenes:function(){return this._candidateGenes},addCancer:function(cancerName,cancerDetails){this.getCancers().hasOwnProperty(cancerName)||(cancerDetails.hasOwnProperty("affected")&&cancerDetails.affected&&editor.getCancerLegend().addCase(cancerName,cancerName,this.getID()),this.getCancers()[cancerName]=cancerDetails)},removeCancer:function(cancerName){this.getCancers().hasOwnProperty(cancerName)&&(editor.getCancerLegend().removeCase(cancerName,this.getID()),delete this._cancers[cancerName])},setCancers:function(cancers){for(var cancerName in this.getCancers())this.getCancers().hasOwnProperty(cancerName)&&this.removeCancer(cancerName);for(var cancerName in cancers)cancers.hasOwnProperty(cancerName)&&this.addCancer(cancerName,cancers[cancerName]);this.getGraphics().updateDisorderShapes(),this.getGraphics().updateCancerAgeOfOnsetLabels()},getCancers:function(){return this._cancers},remove:function($super){this.setDisorders([]),this.setHPO([]),this.setGenes([]),this.setCancers([]),$super()},hasDisorder:function(id){return-1!=this.getDisorders().indexOf(id)},setChildlessStatus:function(status){return this.isValidChildlessStatus(status)||(status=null),status!=this.getChildlessStatus()&&(this._childlessStatus=status,this.setChildlessReason(null),this.getGraphics().updateChildlessShapes(),this.getGraphics().getHoverBox().regenerateHandles()),this.getChildlessStatus()},getSummary:function(){var onceAlive=editor.getGraph().hasRelationships(this.getID()),inactiveStates=!!onceAlive&&["unborn","aborted","miscarriage","stillborn"],disabledStates=!1;(this.isProband()||this.isRegistered())&&(disabledStates=["alive","deceased","unborn","aborted","miscarriage","stillborn"],Helpers.removeFirstOccurrenceByValue(disabledStates,this.getLifeStatus()));var disabledGenders=!(!this.isProband()&&!this.isRegistered())&&[],inactiveGenders=!1,genderSet=editor.getGraph().getPossibleGenders(this.getID());for(gender in genderSet)genderSet.hasOwnProperty(gender)&&(genderSet[gender]||(inactiveGenders||(inactiveGenders=[]),inactiveGenders.push(gender))),this.isProband()&&gender!=this.getGender()&&disabledGenders.push(gender);var childlessInactive=this.isFetus(),disorders=[];this._disordersFullDetails.forEach(function(disorder){disorders.push({id:disorder.disorderId,value:disorder.name,valueAll:disorder.valueAll})});var hpoTerms=[];this.getHPO().forEach(function(hpo){var termName=editor.getHPOLegend().getTerm(hpo).getName(),hpoObj=editor.getHPOLegend().getTerm(hpo);hpoTerms.push({id:hpo,value:termName,valueAll:hpoObj.valueAll})});var cantChangeAdopted=this.isFetus()||editor.getGraph().hasToBeAdopted(this.getID());!cantChangeAdopted&&onceAlive&&(cantChangeAdopted=["adoptedOut","disableViaOpacity"]);var inactiveMonozygothic=!0,disableMonozygothic=!0;if(null!==this._twinGroup){var twins=editor.getGraph().getAllTwinsSortedByOrder(this.getID());if(twins.length>1){inactiveMonozygothic=!1,disableMonozygothic=!1;for(var i=0;i<twins.length;i++)if(editor.getGraph().getGender(twins[i])!=this.getGender()){disableMonozygothic=!0;break}}}var inactiveCarriers=[];"aborted"!=this.getLifeStatus()&&"miscarriage"!=this.getLifeStatus()||inactiveCarriers.push("presymptomatic"),this.isRegistered()&&(inactiveCarriers=["","carrier","uncertain","affected","presymptomatic"]);var inactiveLostContact=this.isProband()||!editor.getGraph().isRelatedToProband(this.getID())||this.isRegistered();return{identifier:{value:this.getID()},nhs_number:{value:this.getNHSNumber(),disabled:!0},chi_number:{value:this.getCHINumber(),disabled:!0},gel_super_family_id:{value:this.getGelSuperFamilyId()},family_id:{value:this.getFamilyId()},consanguineous_population:{value:this.getConsanguineousPopulation()},karyotypic_sex:{value:this.getKaryotypicSex()},ancestries:{value:this.getAncestries()},participant_id:{value:this.getParticipantId(),disabled:!0},registered:{value:this.getRegistered()},first_name:{value:this.getFirstName(),disabled:!0},last_name:{value:this.getLastName(),disabled:!0},last_name_birth:{value:this.getLastNameAtBirth(),disabled:this.isRegistered()},external_id:{value:this.getExternalID(),disabled:this.isRegistered()},gender:{value:this.getGender(),inactive:inactiveGenders,disabled:this.isRegistered()},date_of_birth:{value:this.getBirthDate(),inactive:this.isFetus(),disabled:this.isRegistered()},carrier:{value:this.getCarrierStatus(),disabled:inactiveCarriers},disorders:{value:disorders,disabled:this.isRegistered()},disordersFullDetails:{value:this._disordersFullDetails},disorderType:{value:this.getDisorderType(),disabled:this.isRegistered()},ethnicity:{value:this.getEthnicities(),disabled:this.isRegistered()},candidate_genes:{value:this.getGenes(),disabled:this.isRegistered()},adopted:{value:this.getAdopted(),inactive:cantChangeAdopted,disabled:this.isRegistered()},state:{value:this.getLifeStatus(),inactive:inactiveStates,disabled:disabledStates},date_of_death:{value:this.getDeathDate(),inactive:this.isFetus(),disabled:this.isRegistered()},age_of_death:{value:this.getAgeOfDeath(),inactive:this.isFetus(),disabled:this.isRegistered()||null!=this.getBirthDate()&&null!=this.getDeathDate()},age_of_death_format:{value:this.getAgeOfDeathFormat(),inactive:this.isFetus(),disabled:this.isRegistered()||null!=this.getBirthDate()&&null!=this.getDeathDate()},commentsClinical:{value:this.getComments(),inactive:!1},commentsPersonal:{value:this.getComments(),inactive:!1},commentsCancers:{value:this.getComments(),inactive:!1},gestation_age:{value:this.getGestationAge(),inactive:!this.isFetus(),disabled:this.isRegistered()},childlessSelect:{value:this.getChildlessStatus()?this.getChildlessStatus():"none",inactive:childlessInactive,disabled:this.isRegistered()},childlessText:{value:this.getChildlessReason()?this.getChildlessReason():void 0,inactive:childlessInactive,disabled:!this.getChildlessStatus()||this.isRegistered()},placeholder:{value:!1,inactive:!0},monozygotic:{value:this.getMonozygotic(),inactive:inactiveMonozygothic,disabled:disableMonozygothic||this.isRegistered()},evaluated:{value:this.getEvaluated(),disabled:this.isRegistered()},hpo_positive:{value:hpoTerms,disabled:this.isRegistered()},hpo_positiveFullDetails:{value:this._hpoFullDetails},nocontact:{value:this.getLostContact(),inactive:inactiveLostContact},cancers:{value:this.getCancers(),disabled:this.isRegistered()},phenotipsid:{value:this.getPhenotipsPatientId(),disabled:this.isRegistered()},ageOfOnset:{value:this.getAgeOfOnset(),disabled:this.isRegistered()},hpoPresent:{value:"",disabled:this.isRegistered()},age_of_death_guide:{value:"",inactive:this.isFetus()}}},getProperties:function($super){var info=$super();return""!=this.getPhenotipsPatientId()&&(info.phenotipsId=this.getPhenotipsPatientId()),""!=this.getFirstName()&&(info.fName=this.getFirstName()),""!=this.getLastName()&&(info.lName=this.getLastName()),""!=this.getNHSNumber()&&(info.NHSNumber=this.getNHSNumber()),""!=this.getGelSuperFamilyId()&&(info.gelSuperFamilyId=this.getGelSuperFamilyId()),""!=this.getFamilyId()&&(info.familyId=this.getFamilyId()),""!=this.getKaryotypicSex()&&(info.karyotypicSex=this.getKaryotypicSex()),""!=this.getConsanguineousPopulation()&&(info.consanguineousPopulation=this.getConsanguineousPopulation()),""!=this.getAncestries()&&(info.ancestries=this.getAncestries()),""!=this.getCHINumber()&&(info.CHINumber=this.getCHINumber()),""!=this.getParticipantId()&&(info.participantId=this.getParticipantId()),""!=this.getRegistered()&&(info.registered=this.getRegistered()),""!=this.getLastNameAtBirth()&&(info.lNameAtB=this.getLastNameAtBirth()),""!=this.getExternalID()&&(info.externalID=this.getExternalID()),null!=this.getBirthDate()&&(info.dob=this.getBirthDate().getSimpleObject()),""!=this.getAdopted()&&(info.adoptedStatus=this.getAdopted()),"alive"!=this.getLifeStatus()&&(info.lifeStatus=this.getLifeStatus()),null!=this.getDeathDate()&&(info.dod=this.getDeathDate().getSimpleObject()),""!=this.getAgeOfDeath()&&(info.ageOfDeath=this.getAgeOfDeath()),""!=this.getAgeOfDeathFormat()&&(info.ageOfDeathFormat=this.getAgeOfDeathFormat()),null!=this.getGestationAge()&&(info.gestationAge=this.getGestationAge()),null!=this.getChildlessStatus()&&(info.childlessStatus=this.getChildlessStatus(),info.childlessReason=this.getChildlessReason()),this.getDisorders().length>0&&(info.disorders=this.getDisordersForExport()),this._disordersFullDetails.length>0&&(info.disordersFullDetails=this._disordersFullDetails),Helpers.isObjectEmpty(this.getCancers())||(info.cancers=this.getCancers()),this.getHPO().length>0&&(info.hpoTerms=this.getHPOForExport()),this._hpoFullDetails.length>0&&(info.hpoTermsFullDetails=this._hpoFullDetails),this.getEthnicities().length>0&&(info.ethnicities=this.getEthnicities()),this.getGenes().length>0&&(info.candidateGenes=this.getGenes()),null!==this._twinGroup&&(info.twinGroup=this._twinGroup),this._monozygotic&&(info.monozygotic=this._monozygotic),this._evaluated&&(info.evaluated=this._evaluated),this._carrierStatus&&(info.carrierStatus=this._carrierStatus),this.getLostContact()&&(info.lostContact=this.getLostContact()),""!=this.getPedNumber()&&(info.nodeNumber=this.getPedNumber()),info},assignProperties:function($super,info){if(this._setDefault(),$super(info)){if(info.phenotipsId&&this.getPhenotipsPatientId()!=info.phenotipsId&&this.setPhenotipsPatientId(info.phenotipsId),info.fName&&this.getFirstName()!=info.fName&&this.setFirstName(info.fName),info.lName&&this.getLastName()!=info.lName&&this.setLastName(info.lName),info.participantId&&this.getParticipantId()!=info.participantId&&this.setParticipantId(info.participantId),info.registered&&this.getRegistered()!=info.registered&&this.setRegistered(info.registered),info.NHSNumber&&this.getNHSNumber()!=info.NHSNumber&&this.setNHSNumber(info.NHSNumber),info.gelSuperFamilyId&&this.getGelSuperFamilyId()!=info.gelSuperFamilyId&&this.setGelSuperFamilyId(info.gelSuperFamilyId),info.familyId&&this.getFamilyId()!=info.familyId&&this.setFamilyId(info.familyId),info.karyotypicSex&&this.getKaryotypicSex()!=info.karyotypicSex&&this.setKaryotypicSex(info.karyotypicSex),info.consanguineousPopulation&&this.getConsanguineousPopulation()!=info.consanguineousPopulation&&this.setConsanguineousPopulation(info.consanguineousPopulation),info.ancestries&&this.getAncestries()!=info.ancestries&&this.setAncestries(info.ancestries),info.CHINumber&&this.getCHINumber()!=info.CHINumber&&this.setCHINumber(info.CHINumber),info.lNameAtB&&this.getLastNameAtBirth()!=info.lNameAtB&&this.setLastNameAtBirth(info.lNameAtB),info.externalID&&this.getExternalID()!=info.externalID&&this.setExternalID(info.externalID),info.dob&&this.getBirthDate()!=info.dob&&this.setBirthDate(info.dob),info.disorders){var disorders=[];if(void 0!=info.disordersFullDetails&&info.disordersFullDetails.length>0){for(i=0;i<info.disordersFullDetails.length;i++){var disorder=new Disorder(info.disordersFullDetails[i].disorderId,info.disordersFullDetails[i].name,info.disordersFullDetails[i].ageOfOnset,info.disordersFullDetails[i].disorderType,info.disordersFullDetails[i].valueAll);disorders.push(disorder)}this.setDisorders(disorders)}else this.setDisorders(info.disorders)}if(info.cancers&&this.setCancers(info.cancers),info.hpoTermsFullDetails){this._hpoTermsFullDetails=info.hpoTermsFullDetails.slice();for(i=0;i<this._hpoTermsFullDetails.length;i++)this._hpoTermsFullDetails[i].valueAll||(this._hpoTermsFullDetails[i].valueAll={})}if(info.hpoTerms){var terms=[];if(void 0!=this._hpoTermsFullDetails&&this._hpoTermsFullDetails.length>0){for(var i=0;i<this._hpoTermsFullDetails.length;i++){var term=new HPOTerm(this._hpoTermsFullDetails[i].hpoId,this._hpoTermsFullDetails[i].name,this._hpoTermsFullDetails[i].hpoPresent,this._hpoTermsFullDetails[i].valueAll);terms.push(term)}this.setHPO(terms)}else this.setHPO(info.hpoTerms)}return info.ethnicities&&this.setEthnicities(info.ethnicities),info.candidateGenes&&this.setGenes(info.candidateGenes),info.hasOwnProperty("adoptedStatus")&&this.getAdopted()!=info.adoptedStatus&&this.setAdopted(info.adoptedStatus),info.hasOwnProperty("lifeStatus")&&this.getLifeStatus()!=info.lifeStatus&&this.setLifeStatus(info.lifeStatus),info.dod&&this.getDeathDate()!=info.dod&&this.setDeathDate(info.dod),info.ageOfDeath&&this.getAgeOfDeath()!=info.ageOfDeath&&this.setAgeOfDeath(info.ageOfDeath),info.ageOfDeathFormat&&this.getAgeOfDeathFormat()!=info.ageOfDeathFormat&&this.setAgeOfDeathFormat(info.ageOfDeathFormat),info.gestationAge&&this.getGestationAge()!=info.gestationAge&&this.setGestationAge(info.gestationAge),info.childlessStatus&&this.getChildlessStatus()!=info.childlessStatus&&this.setChildlessStatus(info.childlessStatus),info.childlessReason&&this.getChildlessReason()!=info.childlessReason&&this.setChildlessReason(info.childlessReason),info.hasOwnProperty("twinGroup")&&this._twinGroup!=info.twinGroup&&this.setTwinGroup(info.twinGroup),info.hasOwnProperty("monozygotic")&&this._monozygotic!=info.monozygotic&&this.setMonozygotic(info.monozygotic),info.hasOwnProperty("evaluated")&&this._evaluated!=info.evaluated&&this.setEvaluated(info.evaluated),info.hasOwnProperty("carrierStatus")&&this._carrierStatus!=info.carrierStatus&&this.setCarrierStatus(info.carrierStatus),info.hasOwnProperty("nodeNumber")&&this.getPedNumber()!=info.nodeNumber&&this.setPedNumber(info.nodeNumber),info.hasOwnProperty("lostContact")&&this.getLostContact()!=info.lostContact&&this.setLostContact(info.lostContact),!0}return!1}});Person.addMethods(ChildlessBehavior),Person.setMethods={},Person.copyUnassignedNode=function(person,unRenderedValueAll){var yesFunction=function(){var disorderLoaded=!1,hpoLoaded=!1;unRenderedValueAll.registered=!0;for(var property in unRenderedValueAll)if(Object.prototype.hasOwnProperty.call(unRenderedValueAll,property)){var value=unRenderedValueAll[property],setMethod=Person.setMethods[property];if(!setMethod){console.log("Set method '"+setMethod+"' for property '"+property+"' not specified in 'Person.setMethods'");continue}if("sex"!=property&&"gender"!=property||(value=Person.FormatGender(value)),["gelsuperfamilyid","ancestries","consanguineouspopulation","comments","childlessstatus","childlessreason","karyotypicsex"].indexOf(property.toLocaleLowerCase().trim())>-1)continue;if("disordersFullDetails"==property||"disorders"==property){if(disorderLoaded)continue;if(!unRenderedValueAll.disordersFullDetails){console.log("disordersFullDetails must have been included, otherwise we can not load disorders from 'disorders' in unRendered Nodes");continue}if(unRenderedValueAll.disordersFullDetails){for(var disorders=unRenderedValueAll.disordersFullDetails,newDisorderArray=[],i=0;i<disorders.length;i++){var disorder=new Disorder(disorders[i].disorderId,disorders[i].name,disorders[i].ageOfOnset,disorders[i].disorderType,disorders[i].valueAll);newDisorderArray.push(disorder)}(properties={}).setDisorders=newDisorderArray;event={nodeID:person.getID(),properties:properties};document.fire("pedigree:node:setproperty",event)}disorderLoaded=!0;continue}if("hpoTerms"==property||"hpoTermsFullDetails"==property){if(hpoLoaded)continue;if(!unRenderedValueAll.hpoTermsFullDetails){console.log("hpoTermsFullDetails must have been included, otherwise we can not load HPOs from 'hpoTerms' in unRendered Nodes");continue}if(unRenderedValueAll.hpoTermsFullDetails){for(var HPOs=unRenderedValueAll.hpoTermsFullDetails,newHPOArray=[],i=0;i<HPOs.length;i++){var HPO=new HPOTerm(HPOs[i].hpoId,HPOs[i].name,HPOs[i].hpoPresent,HPOs[i].valueAll);newHPOArray.push(HPO)}(properties={}).setHPO=newHPOArray;event={nodeID:person.getID(),properties:properties};document.fire("pedigree:node:setproperty",event)}hpoLoaded=!0;continue}var properties={};properties[setMethod]=value;var event={nodeID:person.getID(),properties:properties};document.fire("pedigree:node:setproperty",event)}},closeFunction=function(){this.dialog.show()},targetNodeGender=Person.FormatGender(person.getGender()),sourceNodeGender=Person.FormatGender(unRenderedValueAll.sex),genderMessage=void 0;"M"!==targetNodeGender||"F"!==sourceNodeGender&&"O"!==sourceNodeGender&&"unknown"!==sourceNodeGender?"F"!==targetNodeGender||"M"!==sourceNodeGender&&"O"!==sourceNodeGender&&"unknown"!==sourceNodeGender?"O"!==targetNodeGender||"M"!==sourceNodeGender&&"F"!==sourceNodeGender&&"unknown"!==sourceNodeGender||(genderMessage="Gender in target node is 'Other' but in unassigned node it is '"+Person.getGenderString(sourceNodeGender)+"',<br> Are you sure you want to assign the values to this node?"):genderMessage="Gender in target node is 'Female' but in unassigned node it is '"+Person.getGenderString(sourceNodeGender)+"',<br> Are you sure you want to assign the values to this node?":genderMessage="Gender in target node is 'Male' but in unassigned node it is '"+Person.getGenderString(sourceNodeGender)+"',<br> Are you sure you want to assign the values to this node?",genderMessage?editor.getOkCancelDialogue().showCustomized(genderMessage,"Genomics England","Yes",yesFunction,"No",closeFunction,null,!0):yesFunction()},Person.FormatGender=function(genderString){return null==genderString||void 0==genderString?"unknown":"female"==(genderString=genderString.toLowerCase())||"f"==genderString||"2"==genderString?"F":"other"==genderString||"o"==genderString||"9"==genderString?"O":"male"==genderString||"m"==genderString||"1"==genderString?"M":"unknown"},Person.getGenderString=function(genderString){return null==genderString||void 0==genderString?"unknown":"female"==(genderString=genderString.toLowerCase())||"f"==genderString||"2"==genderString?"Female":"other"==genderString||"o"==genderString||"9"==genderString?"Other":"male"==genderString||"m"==genderString||"1"==genderString?"Male":"Unknown"};