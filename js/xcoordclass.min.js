/*! pedigree-editor-tool - v1.3.0 - 2017-05-19
* https://github.com/OxBRCInformatics/pedigree-editor-tool#readme
* Copyright (c) 2017  Licensed AGPL-3.0 */

XCoord=function(xinit,graph){this.halfWidth=[];for(var i=0;i<graph.GG.vWidth.length;i++)this.halfWidth[i]=Math.floor(graph.GG.vWidth[i]/2);this.graph=graph,this.xcoord=xinit||this.init_xcoord()},XCoord.prototype={relationshipOrChhub:function(v){return this.graph.GG.type[v]==BaseGraph.TYPE.RELATIONSHIP||this.graph.GG.type[v]==BaseGraph.TYPE.CHILDHUB},getSeparation:function(v1,v2){return this.relationshipOrChhub(v1)&&this.relationshipOrChhub(v2)?this.graph.horizontalTwinSeparationDist:this.relationshipOrChhub(v1)||this.relationshipOrChhub(v2)?this.graph.horizontalRelSeparationDist:this.graph.GG.type[v1]==BaseGraph.TYPE.VIRTUALEDGE||this.graph.GG.type[v2]==BaseGraph.TYPE.VIRTUALEDGE?this.graph.GG.hasEdge(v1,v2)||this.graph.GG.hasEdge(v2,v1)?this.graph.horizontalRelSeparationDist:this.graph.horizontalTwinSeparationDist:this.graph.GG.type[v1]!=BaseGraph.TYPE.PERSON&&this.graph.GG.type[v2]!=BaseGraph.TYPE.PERSON||this.graph.GG.getTwinGroupId(v1)!=this.graph.GG.getTwinGroupId(v2)||null==this.graph.GG.getTwinGroupId(v1)?this.graph.horizontalPersonSeparationDist:this.graph.horizontalTwinSeparationDist},init_xcoord:function(){for(var xinit=[],r=0;r<this.graph.order.order.length;r++){xinit[this.graph.order.order[r][0]]=this.halfWidth[this.graph.order.order[r][0]];for(var i=1;i<this.graph.order.order[r].length;i++){var vPrev=this.graph.order.order[r][i-1],v=this.graph.order.order[r][i],separation=this.getSeparation(vPrev,v);xinit[v]=xinit[vPrev]+this.halfWidth[vPrev]+separation+this.halfWidth[v]}}return xinit},getLeftMostNoDisturbPosition:function(v){var leftNeighbour=this.graph.order.getLeftNeighbour(v,this.graph.ranks[v]);return null!==leftNeighbour?this.getRightEdge(leftNeighbour)+this.getSeparation(v,leftNeighbour)+this.halfWidth[v]:-1/0},getSlackOnTheLeft:function(v){return this.xcoord[v]-this.getLeftMostNoDisturbPosition(v)},getRightMostNoDisturbPosition:function(v,alsoMoveRelationship){var rightNeighbour=this.graph.order.getRightNeighbour(v,this.graph.ranks[v]);if(null!==rightNeighbour){var rightBoundary=this.getLeftEdge(rightNeighbour)-this.getSeparation(v,rightNeighbour)-this.halfWidth[v];return alsoMoveRelationship&&this.graph.GG.type[rightNeighbour]==BaseGraph.TYPE.RELATIONSHIP&&(rightBoundary+=this.getRightMostNoDisturbPosition(rightNeighbour)-this.xcoord[rightNeighbour]),rightBoundary}return 1/0},getSlackOnTheRight:function(v){return this.getRightMostNoDisturbPosition(v,!1)-this.xcoord[v]},getLeftEdge:function(v){return this.xcoord[v]-this.halfWidth[v]},getRightEdge:function(v){return this.xcoord[v]+this.halfWidth[v]},shiftLeftOneVertex:function(v,amount){var leftBoundary=this.getLeftMostNoDisturbPosition(v),actualShift=Math.min(amount,this.xcoord[v]-leftBoundary);return this.xcoord[v]-=actualShift,actualShift},shiftRightOneVertex:function(v,amount){var rightBoundary=this.getRightMostNoDisturbPosition(v),actualShift=Math.min(amount,rightBoundary-this.xcoord[v]);return this.xcoord[v]+=actualShift,actualShift},shiftRightAndShiftOtherIfNecessary:function(v,amount){this.xcoord[v]+=amount;for(var rightEdge=this.getRightEdge(v),rank=this.graph.ranks[v],i=this.graph.order.vOrder[v]+1;i<this.graph.order.order[rank].length;i++){var rightNeighbour=this.graph.order.order[rank][i];if(this.getLeftEdge(rightNeighbour)>=rightEdge+this.getSeparation(v,rightNeighbour))break;this.xcoord[rightNeighbour]=rightEdge+this.getSeparation(v,rightNeighbour)+this.halfWidth[rightNeighbour],rightEdge=this.getRightEdge(rightNeighbour),v=rightNeighbour}return amount},moveNodeAsCloseToXAsPossible:function(v,targetX){var x=this.xcoord[v];if(x>targetX){var leftMostOK=this.getLeftMostNoDisturbPosition(v);this.xcoord[v]=leftMostOK<=targetX?targetX:leftMostOK}else{var rightMostOK=this.getRightMostNoDisturbPosition(v);this.xcoord[v]=rightMostOK>=targetX?targetX:rightMostOK}return this.xcoord[v]!=x},normalize:function(){for(var leftMostElement=Helpers.indexOfLastMinElementInArray(this.xcoord),moveAmount=this.xcoord[leftMostElement]-this.halfWidth[leftMostElement],i=0;i<this.xcoord.length;i++)this.xcoord[i]-=moveAmount},copy:function(){return new XCoord(this.xcoord.slice(0),this.graph,this.halfWidth)},findVertexSetSlacks:function(set){var leftSlack=1/0,rightSlack=1/0;for(var v in set)if(set.hasOwnProperty(v)){var leftNeighbour=this.graph.order.getLeftNeighbour(v,this.graph.ranks[v]);set.hasOwnProperty(leftNeighbour)||(leftSlack=Math.min(leftSlack,this.getSlackOnTheLeft(v)));var rightNeighbour=this.graph.order.getRightNeighbour(v,this.graph.ranks[v]);set.hasOwnProperty(rightNeighbour)||(rightSlack=Math.min(rightSlack,this.getSlackOnTheRight(v)))}return{rightSlack:rightSlack,leftSlack:leftSlack}}},XCoordScore=function(maxRealVertexId){this.score=0,this.inEdgeMaxLen=[],this.maxRealVertexId=maxRealVertexId,this.numStraightLong=0},XCoordScore.prototype={add:function(amount){this.score+=amount},addEdge:function(v,u,length){u>this.maxRealVertexId&&(0==length&&v>this.maxRealVertexId&&this.numStraightLong++,length/=2),(!this.inEdgeMaxLen[u]||length>this.inEdgeMaxLen[u])&&(this.inEdgeMaxLen[u]=length);for(var i=0;i<u;i++)void 0===this.inEdgeMaxLen[i]&&(this.inEdgeMaxLen[i]=0)},isBettertThan:function(otherScore){if(this.score==otherScore.score){if(this.numStraightLong==otherScore.numStraightLong){var score1=0==this.inEdgeMaxLen.length?0:this.inEdgeMaxLen.reduce(function(a,b){return a+b}),score2=0==otherScore.inEdgeMaxLen.length?0:otherScore.inEdgeMaxLen.reduce(function(a,b){return a+b});return score1==score2?Math.max.apply(null,this.inEdgeMaxLen)<Math.max.apply(null,otherScore.inEdgeMaxLen):score1<score2}return this.numStraightLong>otherScore.numStraightLong}return this.score<otherScore.score}},VerticalLevels=function(){this.rankVerticalLevels=[],this.childEdgeLevel=[],this.outEdgeVerticalLevel=[]},VerticalLevels.prototype={copy:function(){var result=new VerticalLevels;return result.rankVerticalLevels=this.rankVerticalLevels.slice(0),result.childEdgeLevel=this.childEdgeLevel.slice(0),result.outEdgeVerticalLevel=this.outEdgeVerticalLevel.slice(0),result}};